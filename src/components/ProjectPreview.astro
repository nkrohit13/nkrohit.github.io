---
import type { CollectionEntry } from 'astro:content';

// Props
export interface Props {
    project: CollectionEntry<'projects'>;
    showThumbnail?: boolean;
    className?: string;
    headingLevel?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';
}

const {
    project,
    showThumbnail = false,
    className = '',
    headingLevel = 'h2' // Default to h2
} = Astro.props;

// Extract project data
const { title, tags = [], publishDate, description } = project.data;

// Get the image from SEO data or first image in content
const imageUrl = project.data.seo?.image?.src || project.body?.match(/!\[.*?\]\((.*?)\)/)?.[1] || '';

// Format date as Month YYYY (e.g., August 2023)
const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
};
---

<div class:list={['project-preview grid-item', className]}>
    <a href={`/projects/${project.id}/`} class="group">
        {/* Thumbnail / Icon */}
        {
            imageUrl && showThumbnail && (
                <div class="image-container relative">
                    <img src={imageUrl} alt={title} loading="lazy" class={project.data.darkImage ? 'dark:hidden' : ''} />
                    {project.data.darkImage && (
                        <img src={project.data.darkImage} alt={title} loading="lazy" class="hidden dark:block absolute inset-0 w-full h-full object-cover" />
                    )}
                </div>
            )
        }

        {/* Project Info */}
        <div class="content-container">
            <div class="flex flex-col gap-1">
                <div class="flex items-center gap-3 flex-wrap">
                    {
                        (() => {
                            const headingClass = 'text-lg font-bold text-gray-900 dark:text-white';
                            switch (headingLevel) {
                                case 'h1':
                                    return <h1 class={headingClass}>{title}</h1>;
                                case 'h2':
                                    return <h2 class={headingClass}>{title}</h2>;
                                case 'h3':
                                    return <h3 class={headingClass}>{title}</h3>;
                                case 'h4':
                                    return <h4 class={headingClass}>{title}</h4>;
                                case 'h5':
                                    return <h5 class={headingClass}>{title}</h5>;
                                case 'h6':
                                    return <h6 class={headingClass}>{title}</h6>;
                                default:
                                    return <h2 class={headingClass}>{title}</h2>;
                            }
                        })()
                    }
                </div>

                {description && <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed line-clamp-2">{description}</p>}
            </div>

            {publishDate && <p class="text-xs text-gray-400 mt-2">{formatDate(publishDate.toString())}</p>}
        </div>
    </a>
</div>

<style>
    /* Grid Layout Styles */
    .grid-item a {
        @apply block h-full;
    }

    .grid-item .image-container {
        @apply mb-4 aspect-video w-full overflow-hidden rounded-xl bg-gray-100 dark:bg-gray-800;
    }

    .grid-item img {
        @apply w-full h-full object-cover;
    }
</style>
